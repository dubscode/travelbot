{% extends 'base.html.twig' %}
{% set is_auth_page = true %}

{% block title %}Create your account{% endblock %}

{% block body %}
    {% set form_content %}
        {% for flash_error in app.flashes('verify_email_error') %}
            {% include 'components/_form_error.html.twig' with {
                'message': flash_error,
                'type': 'error'
            } %}
        {% endfor %}

        {% if form_errors(registrationForm) %}
            {% include 'components/_form_error.html.twig' with {
                'message': form_errors(registrationForm),
                'type': 'error'
            } %}
        {% endif %}

        {{ form_start(registrationForm, {'attr': {'class': 'space-y-6'}}) }}
            <div>
                <label for="{{ registrationForm.name.vars.id }}" class="block text-sm/6 font-medium text-gray-900 dark:text-gray-100">{{ form_label(registrationForm.name).labelFormat|default('Full name') }}</label>
                <div class="mt-2">
                    {{ form_widget(registrationForm.name, {'attr': {'class': 'block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-blue-500'}}) }}
                </div>
                {% if form_errors(registrationForm.name) %}
                    <div class="mt-2 text-sm text-red-600 dark:text-red-400">
                        {{ form_errors(registrationForm.name) }}
                    </div>
                {% endif %}
            </div>
            
            <div>
                <label for="{{ registrationForm.email.vars.id }}" class="block text-sm/6 font-medium text-gray-900 dark:text-gray-100">Email address</label>
                <div class="mt-2">
                    {{ form_widget(registrationForm.email, {'attr': {'class': 'block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-blue-500'}}) }}
                </div>
                {% if form_errors(registrationForm.email) %}
                    <div class="mt-2 text-sm text-red-600 dark:text-red-400">
                        {{ form_errors(registrationForm.email) }}
                    </div>
                {% endif %}
            </div>
            
            <div>
                <label for="{{ registrationForm.plainPassword.vars.id }}" class="block text-sm/6 font-medium text-gray-900 dark:text-gray-100">Password</label>
                <div class="mt-2">
                    {{ form_widget(registrationForm.plainPassword, {'attr': {'class': 'block w-full rounded-md bg-white px-3 py-1.5 text-base text-gray-900 outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline-2 focus:-outline-offset-2 focus:outline-blue-600 sm:text-sm/6 dark:bg-white/5 dark:text-white dark:outline-white/10 dark:placeholder:text-gray-500 dark:focus:outline-blue-500'}}) }}
                </div>
                {% if form_errors(registrationForm.plainPassword) %}
                    <div class="mt-2 text-sm text-red-600 dark:text-red-400">
                        {{ form_errors(registrationForm.plainPassword) }}
                    </div>
                {% endif %}
            </div>
            
            <div class="flex items-center">
                {{ form_widget(registrationForm.agreeTerms, {'attr': {'class': 'h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-600 dark:border-gray-600 dark:bg-gray-700 dark:ring-offset-gray-800 dark:focus:ring-blue-500'}}) }}
                <div class="ml-3 text-sm">
                    {{ form_label(registrationForm.agreeTerms, null, {'label_attr': {'class': 'text-gray-900 dark:text-gray-100'}}) }}
                </div>
            </div>
            {% if form_errors(registrationForm.agreeTerms) %}
                <div class="text-sm text-red-600 dark:text-red-400">
                    {{ form_errors(registrationForm.agreeTerms) }}
                </div>
            {% endif %}

            {% include 'components/_form_button.html.twig' with {
                'text': 'Create account',
                'type': 'submit'
            } %}
        {{ form_end(registrationForm) }}
    {% endset %}

    {% if app.user %}
        {% set logged_in_content %}
            {% include 'components/_already_logged_in.html.twig' with {
                'user': app.user,
                'show_register_option': true
            } %}
        {% endset %}
        
        {% include 'components/_auth_layout.html.twig' with {
            'title': 'Welcome back!',
            'form_content': logged_in_content,
            'footer_links': []
        } %}
    {% else %}
        {% include 'components/_auth_layout.html.twig' with {
            'title': 'Create your account',
            'form_content': form_content,
            'footer_links': [
                {
                    'prefix': 'Already have an account? ',
                    'text': 'Sign in',
                    'url': path('app_login')
                }
            ]
        } %}
    {% endif %}
{% endblock %}
