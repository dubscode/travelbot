{% extends 'base.html.twig' %}

{% block title %}Travel Chat - AI Assistant{% endblock %}

{% block header %}
    {# Use custom header for chat page #}
    <header class="hero">
        <div class="hero__inner">
            <div class="hero__title">🌍 TravelBot AI Assistant</div>
            <p class="hero__subtitle">Welcome back, {{ user.name }}! Let's plan your next adventure.</p>
        </div>
    </header>
{% endblock %}

{% block body %}
<main class="card" data-controller="chat">
    <section id="messages" class="chat" data-chat-target="messages">
        <turbo-frame id="messages-container">
        {% if messages|length == 0 %}
            <div class="welcome">
                <div class="welcome__content">
                    <h3>👋 Hello {{ user.name }}!</h3>
                    <p>I'm your AI travel advisor. I can help you discover amazing destinations, plan trips, and provide personalized travel recommendations.</p>
                    
                    {% if user.budget or user.interests or user.climatePreferences %}
                    <div class="preferences">
                        <h4>Your Preferences:</h4>
                        <ul>
                            {% if user.budget %}
                                <li>Budget: ${{ user.budget }}/day</li>
                            {% endif %}
                            {% if user.interests %}
                                <li>Interests: {{ user.interests|join(', ') }}</li>
                            {% endif %}
                            {% if user.climatePreferences %}
                                <li>Climate: {{ user.climatePreferences|join(', ') }}</li>
                            {% endif %}
                        </ul>
                    </div>
                    {% endif %}
                    
                    <p>What kind of trip are you planning?</p>
                </div>
            </div>
        {% else %}
            {% for message in messages %}
                {% if message.role == 'user' %}
                    <article class="msg msg--user">
                        <div class="msg__bubble">
                            <div class="msg__text">{{ message.content|nl2br }}</div>
                        </div>
                        <div class="msg__avatar">{{ user.name|first|upper }}</div>
                    </article>
                {% else %}
                    <article class="msg msg--bot">
                        <div class="msg__avatar">🤖</div>
                        <div class="msg__bubble">
                            <h4 class="msg__title">TravelBot</h4>
                            <div class="msg__text">{{ message.content|nl2br }}</div>
                            {% if message.modelUsed %}
                                <div class="msg__meta">
                                    {% if 'haiku' in message.modelUsed|lower %}
                                        ⚡ Fast response
                                    {% else %}
                                        🧠 Detailed response
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </article>
                {% endif %}
            {% endfor %}
        {% endif %}
        </turbo-frame>
    </section>

    <form class="composer" 
          action="{{ path('app_chat_send') }}" 
          method="post" 
          data-action="submit->chat#send"
          data-turbo-frame="messages-container">
        <input class="input" 
               name="message" 
               placeholder="Ask about destinations, travel tips, or plan your trip..." 
               autocomplete="off" 
               required
               aria-label="Chat message"
               data-chat-target="input" />
        <button class="btn btn--primary" 
                type="submit" 
                data-chat-target="sendBtn">
            Send ✈️
        </button>
    </form>
</main>
{% endblock %}
